<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Too Many Types Two</title>

  <script>
    window.gameconfig = {
      name: "Too Many Types Two",
      file: "https://cdn.jsdelivr.net/gh/imightexistidontknow/asdad/Too Many Types 2 (v1.1.1) (3).gba",
      core: "mgba",
      min: 1,
      max: 2
    };

    function getParts(file, start, end) {
      const parts = [];
      for (let i = start; i <= end; i++) {
        parts.push(`${file}.part${i}`);
      }
      return parts;
    }

    function mergeFiles(parts, onProgress) {
      return new Promise(async (resolve, reject) => {
        try {
          const buffers = [];
          for (let i = 0; i < parts.length; i++) {
            const res = await fetch(parts[i]);
            if (!res.ok) throw new Error("Failed to fetch " + parts[i]);
            buffers.push(await res.arrayBuffer());
            onProgress(i + 1);
          }
          const blob = new Blob(buffers, {
            type: "application/octet-stream"
          });
          resolve(URL.createObjectURL(blob));
        } catch (e) {
          reject(e);
        }
      });
    }
  </script>

  <style>
    html, body {
      margin: 0;
      width: 100%;
      height: 100%;
      background: #121212;
      color: white;
      font-family: Arial, sans-serif;
    }
    #game {
      width: 100vw;
      height: 100vh;
    }
    #loading {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #121212;
      z-index: 9999;
    }
  </style>
</head>

<body>
  <div id="loading">
    <div id="progress">Loading: 0/0</div>
    <div>First-time loading may take longer...</div>
  </div>

  <div id="game"></div>

  <script>
    const parts = getParts(
      window.gameconfig.file,
      window.gameconfig.min,
      window.gameconfig.max
    );

    const progressEl = document.getElementById("progress");
    progressEl.textContent = `Loading: 0/${parts.length}`;

    mergeFiles(parts, loaded => {
      progressEl.textContent = `Loading: ${loaded}/${parts.length}`;
    })
    .then(gameUrl => {
      document.getElementById("loading").remove();

      window.EJS_player = "#game";
      window.EJS_core = window.gameconfig.core;
      window.EJS_gameName = window.gameconfig.name;
      window.EJS_color = "#0064ff";
      window.EJS_startOnLoaded = true;
      window.EJS_pathtodata = "https://cdn.jsdelivr.net/gh/genizy/emu@master/";
      window.EJS_gameUrl = gameUrl;

      const script = document.createElement("script");
      script.src = "https://cdn.jsdelivr.net/gh/genizy/emu@master/loader.js";
      script.defer = true;
      document.body.appendChild(script);
    })
    .catch(err => {
      console.error(err);
      progressEl.textContent = "Error loading game";
    });
  </script>
</body>
</html>
